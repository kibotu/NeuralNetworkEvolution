<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="description" content="Watch creatures learn to find food through neural networks and evolutionary algorithms">
  <meta name="theme-color" content="#0f172a">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Neural Network Evolution - Neuroevolution Simulation</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>

  <div id="loading" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p>Initializing Neural Network Evolution...</p>
  </div>

  <div class="container">
    <div class="header">
      <a href="../" class="back-link">All Experiments</a>
      <h1>Neuroevolution</h1>
      <p>Creatures with neural network brains evolved via genetic algorithms <i class="hint" data-tip="Each creature has a tiny feed-forward neural net. The best survivors pass their weights to the next generation through selection, crossover, and mutation.">?</i></p>
    </div>

    <div class="main-content">
      <div class="canvas-column">
        <!-- Generation progress bar -->
        <div class="progress-bar-container">
          <div class="progress-bar" id="generationProgress"></div>
          <span class="progress-label" id="progressLabel">Gen 0 &mdash; 0%</span>
        </div>

        <div class="canvas-container">
          <canvas id="simulationCanvas"></canvas>
        </div>

        <!-- Charts row -->
        <div class="charts-row">
          <div class="chart-card">
            <h3>Fitness Over Generations</h3>
            <canvas id="fitnessChart"></canvas>
          </div>
          <div class="chart-card">
            <h3>Best Creature Brain</h3>
            <canvas id="nnDiagram"></canvas>
          </div>
        </div>
      </div>

      <div class="control-panel">
        <div class="panel-section">
          <h2>Controls</h2>
          <div class="control-group">
            <button id="pauseBtn" class="btn btn-primary">Pause</button>
            <button id="restartBtn" class="btn btn-secondary">Restart</button>
            <button id="cloneBtn" class="btn btn-accent">Clone <i class="hint" data-tip="Copy the best creatures' brains into a fresh generation">?</i></button>
          </div>
          <div class="control-group">
            <label for="speedSlider">
              Speed: <span id="speedValue">1.0</span>x <i class="hint" data-tip="Simulation time multiplier">?</i>
            </label>
            <input type="range" id="speedSlider" min="0.1" max="10" step="0.1" value="1">
          </div>
        </div>

        <div class="panel-section">
          <h2>Statistics</h2>
          <div class="stats-grid">
            <div class="stat-item"><span class="stat-label">Generation</span><span class="stat-value" id="generation">0</span></div>
            <div class="stat-item"><span class="stat-label">Alive</span><span class="stat-value" id="aliveCount">0</span></div>
            <div class="stat-item"><span class="stat-label">Dead</span><span class="stat-value" id="deadCount">0</span></div>
            <div class="stat-item"><span class="stat-label">Tick</span><span class="stat-value" id="currentTick">0</span></div>
            <div class="stat-item"><span class="stat-label">Avg Fitness</span><span class="stat-value" id="avgFitness">0</span></div>
            <div class="stat-item"><span class="stat-label">Best Fitness</span><span class="stat-value" id="bestFitness">0</span></div>
            <div class="stat-item"><span class="stat-label">Food Eaten</span><span class="stat-value" id="foodEaten">0</span></div>
            <div class="stat-item"><span class="stat-label">Time</span><span class="stat-value" id="totalTime">0s</span></div>
          </div>
        </div>

        <div class="panel-section">
          <h2>Parameters <i class="hint" data-tip="Click Apply to restart with new settings">?</i></h2>

          <div class="control-group">
            <label for="worldSizeSlider">World Size: <span id="worldSizeValue">40</span></label>
            <input type="range" id="worldSizeSlider" min="20" max="200" step="10" value="40">
          </div>
          <div class="control-group">
            <label for="populationSlider">Population: <span id="populationValue">50</span></label>
            <input type="range" id="populationSlider" min="10" max="200" step="10" value="50">
          </div>
          <div class="control-group">
            <label for="foodSlider">Food Supply: <span id="foodValue">80</span></label>
            <input type="range" id="foodSlider" min="10" max="300" step="10" value="80">
          </div>
          <div class="control-group">
            <label for="ticksSlider">Duration (s): <span id="ticksValue">20</span></label>
            <input type="range" id="ticksSlider" min="5" max="120" step="5" value="20">
          </div>
          <div class="control-group">
            <label for="hiddenLayerSlider">Hidden Neurons: <span id="hiddenLayerValue">10</span> <i class="hint" data-tip="Fewer neurons = faster evolution but less complex behaviour">?</i></label>
            <input type="range" id="hiddenLayerSlider" min="4" max="128" step="2" value="10">
          </div>
          <div class="control-group">
            <label for="mutationSlider">Mutation: <span id="mutationValue">12</span>%</label>
            <input type="range" id="mutationSlider" min="0" max="30" step="0.5" value="12">
          </div>
          <div class="control-group">
            <label for="crossoverSlider">Crossover: <span id="crossoverValue">65</span>%</label>
            <input type="range" id="crossoverSlider" min="20" max="80" step="5" value="65">
          </div>
          <div class="control-group">
            <label for="minSpeedSlider">Min Speed: <span id="minSpeedValue">0</span> u/s</label>
            <input type="range" id="minSpeedSlider" min="0" max="5" step="0.1" value="0">
          </div>
          <div class="control-group">
            <label for="maxSpeedSlider">Max Speed: <span id="maxSpeedValue">6</span> u/s</label>
            <input type="range" id="maxSpeedSlider" min="1" max="20" step="0.5" value="6">
          </div>
          <div class="control-group">
            <label for="minRotationSlider">Min Rotation: <span id="minRotationValue">0</span> deg/s</label>
            <input type="range" id="minRotationSlider" min="0" max="90" step="5" value="0">
          </div>
          <div class="control-group">
            <label for="maxRotationSlider">Max Rotation: <span id="maxRotationValue">180</span> deg/s</label>
            <input type="range" id="maxRotationSlider" min="10" max="360" step="5" value="180">
          </div>
          <div class="control-group">
            <button id="applyBtn" class="btn btn-primary">Apply Changes</button>
          </div>
        </div>

        <div class="panel-section">
          <h2>Visualization</h2>
          <div class="control-group">
            <label class="checkbox-label"><input type="checkbox" id="showTargetVectors"><span>Target Vectors (Red)</span></label>
          </div>
          <div class="control-group">
            <label class="checkbox-label"><input type="checkbox" id="showVelocityVectors"><span>Velocity Vectors (Blue)</span></label>
          </div>
          <div class="control-group">
            <label class="checkbox-label"><input type="checkbox" id="showAntennaVectors"><span>Antenna Vectors (Yellow)</span></label>
          </div>
          <div class="control-group">
            <label class="checkbox-label"><input type="checkbox" id="showRotationVectors"><span>Rotation Vectors (Green)</span></label>
          </div>
        </div>

        <div class="panel-section">
          <h2>About</h2>
          <p class="info-text">
            Each creature has a feed-forward neural network (6 inputs, hidden layer, 2 outputs).
            Inputs: direction to food (sin/cos), food proximity, wall proximity (X/Y), current speed.
            Outputs: rotation rate and movement speed.
            Evolution uses tournament selection, uniform crossover, and adaptive mutation.
          </p>
        </div>
      </div>
    </div>

    <div class="generation-history">
      <h2>Generation History</h2>
      <div class="table-container">
        <table id="generationTable">
          <thead>
            <tr>
              <th>Gen</th>
              <th>Duration</th>
              <th>Survivors</th>
              <th>Avg Fitness</th>
              <th>Best Fitness</th>
              <th>Food Eaten</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody id="generationTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script src="js/vendor/three.min.js"></script>
  <script type="module" src="js/main.js"></script>
</body>
</html>
